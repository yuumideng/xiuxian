# 境界系数系统（新版本 - 指数增长）

## 📋 概述

境界系数是修仙游戏中的核心成长机制，影响战斗属性和修炼速度的计算。新版本采用指数增长设计，使后期境界的提升更有价值。

## 🎯 设计规则

### 基本规则

- **练气期（大境界1）**：每小境界 +1（1 → 10）
- **筑基期（大境界2）**：每小境界 +1（11 → 20）
- **金丹期（大境界3）**：每小境界 +2（22 → 40）
- **元婴期（大境界4）**：每小境界 +4（44 → 80）
- **化神期（大境界5）**：每小境界 +8（88 → 160）

### 增长公式

```
大境界1-2：每小境界 +1
大境界n（n≥3）：每小境界 +2^(n-2)
```

## 📊 详细数值表

### 练气期（大境界1）

| 小境界 | 等级 | 境界系数 | 增量 |
|--------|------|----------|------|
| 1层    | 1    | 1        | +1   |
| 2层    | 2    | 2        | +1   |
| 3层    | 3    | 3        | +1   |
| 4层    | 4    | 4        | +1   |
| 5层    | 5    | 5        | +1   |
| 6层    | 6    | 6        | +1   |
| 7层    | 7    | 7        | +1   |
| 8层    | 8    | 8        | +1   |
| 9层    | 9    | 9        | +1   |
| 10层   | 10   | 10       | +1   |

**总增长**：9（从1到10）

### 筑基期（大境界2）

| 小境界 | 等级 | 境界系数 | 增量 |
|--------|------|----------|------|
| 1层    | 11   | 11       | +1   |
| 2层    | 12   | 12       | +1   |
| 3层    | 13   | 13       | +1   |
| 4层    | 14   | 14       | +1   |
| 5层    | 15   | 15       | +1   |
| 6层    | 16   | 16       | +1   |
| 7层    | 17   | 17       | +1   |
| 8层    | 18   | 18       | +1   |
| 9层    | 19   | 19       | +1   |
| 10层   | 20   | 20       | +1   |

**总增长**：9（从11到20）

### 金丹期（大境界3）

| 小境界 | 等级 | 境界系数 | 增量 |
|--------|------|----------|------|
| 1层    | 21   | 22       | +2   |
| 2层    | 22   | 24       | +2   |
| 3层    | 23   | 26       | +2   |
| 4层    | 24   | 28       | +2   |
| 5层    | 25   | 30       | +2   |
| 6层    | 26   | 32       | +2   |
| 7层    | 27   | 34       | +2   |
| 8层    | 28   | 36       | +2   |
| 9层    | 29   | 38       | +2   |
| 10层   | 30   | 40       | +2   |

**总增长**：18（从22到40）

### 元婴期（大境界4）

| 小境界 | 等级 | 境界系数 | 增量 |
|--------|------|----------|------|
| 1层    | 31   | 44       | +4   |
| 2层    | 32   | 48       | +4   |
| 3层    | 33   | 52       | +4   |
| 4层    | 34   | 56       | +4   |
| 5层    | 35   | 60       | +4   |
| 6层    | 36   | 64       | +4   |
| 7层    | 37   | 68       | +4   |
| 8层    | 38   | 72       | +4   |
| 9层    | 39   | 76       | +4   |
| 10层   | 40   | 80       | +4   |

**总增长**：36（从44到80）

### 化神期（大境界5）

| 小境界 | 等级 | 境界系数 | 增量 |
|--------|------|----------|------|
| 1层    | 41   | 88       | +8   |
| 2层    | 42   | 96       | +8   |
| 3层    | 43   | 104      | +8   |
| 4层    | 44   | 112      | +8   |
| 5层    | 45   | 120      | +8   |
| 6层    | 46   | 128      | +8   |
| 7层    | 47   | 136      | +8   |
| 8层    | 48   | 144      | +8   |
| 9层    | 49   | 152      | +8   |
| 10层   | 50   | 160      | +8   |

**总增长**：72（从88到160）

## 📈 增长趋势分析

### 各大境界增长对比

| 大境界 | 起始系数 | 结束系数 | 总增长 | 平均每层增长 | 增长倍数 |
|--------|----------|----------|--------|--------------|----------|
| 练气期 | 1        | 10       | 9      | 1            | 10x      |
| 筑基期 | 11       | 20       | 9      | 1            | 1.82x    |
| 金丹期 | 22       | 40       | 18     | 2            | 1.82x    |
| 元婴期 | 44       | 80       | 36     | 4            | 1.82x    |
| 化神期 | 88       | 160      | 72     | 8            | 1.82x    |

### 关键节点对比

| 境界节点       | 等级 | 旧系数 | 新系数 | 增长倍数 |
|----------------|------|--------|--------|----------|
| 练气初期       | 1    | 1      | 1      | 1.00x    |
| 练气大圆满     | 10   | 1      | 10     | 10.00x   |
| 筑基初期       | 11   | 2      | 11     | 5.50x    |
| 筑基大圆满     | 20   | 2      | 20     | 10.00x   |
| 金丹初期       | 21   | 3      | 22     | 7.33x    |
| 金丹大圆满     | 30   | 3      | 40     | 13.33x   |
| 元婴初期       | 31   | 4      | 44     | 11.00x   |
| 元婴大圆满     | 40   | 4      | 80     | 20.00x   |
| 化神初期       | 41   | 5      | 88     | 17.60x   |
| 化神大圆满     | 50   | 5      | 160    | 32.00x   |

## 🔧 实现细节

### 核心函数

```javascript
export function getRealmCoefficient(level) {
  // 计算大境界级别（每10个小等级为一个大境界）
  const realmLevel = Math.floor((level - 1) / 10) + 1
  // 计算当前大境界内的小境界（1-10）
  const subLevel = ((level - 1) % 10) + 1
  
  // 计算前面所有大境界的累计系数
  let baseCoefficient = 0
  
  for (let i = 1; i < realmLevel; i++) {
    if (i <= 2) {
      // 练气和筑基：每小境界 +1，共10个小境界
      baseCoefficient += 10
    } else {
      // 金丹及以上：每小境界 +2^(i-2)，共10个小境界
      baseCoefficient += 10 * Math.pow(2, i - 2)
    }
  }
  
  // 计算当前大境界内的增量
  let currentIncrement = 0
  if (realmLevel <= 2) {
    // 练气和筑基：每小境界 +1
    currentIncrement = subLevel
  } else {
    // 金丹及以上：每小境界 +2^(realmLevel-2)
    currentIncrement = subLevel * Math.pow(2, realmLevel - 2)
  }
  
  return baseCoefficient + currentIncrement
}
```

### 使用场景

境界系数在以下计算中使用：

1. **战斗属性计算**（`battleCalculator.js`）
   ```javascript
   // 最终属性 = 基础属性 * (1 + 境界系数) + 加成
   const finalAttribute = baseAttribute * (1 + realmCoefficient) + bonuses
   ```

2. **修炼速度计算**（`growthCalculator.js`）
   ```javascript
   // A = (1 + 境界系数) * (1 + 历练层数) * (1 + 轮回加成)
   const A = (1 + realmCoefficient) * (1 + trainingLevel) * (1 + reincarnationBonus)
   ```

## 🎮 游戏性影响

### 优势

1. **更有价值的小境界提升**
   - 旧系统：小境界提升无意义（境界系数不变）
   - 新系统：每个小境界都有实质性提升

2. **指数增长的后期体验**
   - 后期境界的每一层提升都更有价值
   - 化神期每层提升相当于练气期8层

3. **更合理的数值曲线**
   - 避免前期过于平缓
   - 后期增长更有冲击力

### 平衡性

- **练气期**：新手友好，线性增长
- **筑基期**：过渡期，保持线性
- **金丹期**：开始加速，每层+2
- **元婴期**：显著加速，每层+4
- **化神期**：爆发增长，每层+8

## 📝 示例计算

### 示例1：练气10层 vs 筑基1层

```
练气10层：境界系数 = 10
筑基1层：境界系数 = 11
提升：+1（10%增长）
```

### 示例2：筑基10层 vs 金丹1层

```
筑基10层：境界系数 = 20
金丹1层：境界系数 = 22
提升：+2（10%增长）
```

### 示例3：金丹10层 vs 元婴1层

```
金丹10层：境界系数 = 40
元婴1层：境界系数 = 44
提升：+4（10%增长）
```

### 示例4：元婴10层 vs 化神1层

```
元婴10层：境界系数 = 80
化神1层：境界系数 = 88
提升：+8（10%增长）
```

## 🔄 与旧系统对比

### 旧系统

- 只看大境界，小境界无意义
- 练气1层 = 练气10层 = 1
- 筑基1层 = 筑基10层 = 2
- 增长过于简单

### 新系统

- 每个小境界都有价值
- 练气1层 = 1，练气10层 = 10
- 筑基1层 = 11，筑基10层 = 20
- 指数增长，更有深度

## ✅ 测试验证

所有测试用例已通过验证：

- ✅ 练气期：1 → 10（每层+1）
- ✅ 筑基期：11 → 20（每层+1）
- ✅ 金丹期：22 → 40（每层+2）
- ✅ 元婴期：44 → 80（每层+4）
- ✅ 化神期：88 → 160（每层+8）

## 🎯 总结

新的境界系数系统通过指数增长设计，使每个小境界的提升都有实质性意义，同时保持了合理的数值曲线和游戏平衡性。这个设计既增加了游戏深度，又提升了玩家的成就感。
